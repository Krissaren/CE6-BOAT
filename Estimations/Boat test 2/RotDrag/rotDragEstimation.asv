
clc
clear

f = fopen('throt14957rud82295.txt');
unParsedNMEAdata = fread(f);
pnmea = nmeaParser("MessageIDs",["VTG","GGA"]);
[VTG, GGA] = pnmea(unParsedNMEAdata);

Time = [GGA(:).UTCTime];

secs = seconds(Time(1:437) - Time(1))




CourseAngle = [VTG(:).TrueCourseAngle];
CourseAngle(end) = [];

CourseAngleNew = CourseAngle(1:93);
CourseAngleNew1 = CourseAngle(94:422) + 360;
CourseAngleNew2 = CourseAngle(423:437) + 720;



CourseAngleFinal = [CourseAngleNew CourseAngleNew1 CourseAngleNew2];


%{
Vel = gradient(CourseAngleFinal)./0.05

AngleVel = regress(Secs', CourseAngleFinalFinal)

smth = mean(Secs)-1.21*mean(CourseAngleFinal);
fx2 = @(xf) smth+AngleVel(1)*xf;

fplot(fx2)
hold on 
plot(CourseAngleFinalFinal)



plot(CourseAngleFinalFinal)

X = [ones(size(x)) x];

beta = regress(CourseAngleFinalFinal,)
%}

plot(secs, CourseAngleFinal)

%%

EQs = [11150 132652 23.26; 11174 82295 15.57; 11260 44290 11.5; 14193 126931 29.97; 13344 82276 18.55;
    13381 44260 13.23; 14736 132652 33.86; 14957 82295 23.88; 14941 44358 12.44]; %Throttle, rudder and beta for their regressions

EQsNy = [11260 44290 11.5; 11174 82295 15.57; 11150 132652 23.26; 13381 44260 13.23; 13344 82276 18.55;
    14193 126931 29.97; 14736 132652 33.86; 14957 82295 23.88; 14941 44358 12.44];

ThrottleForce = EQs(1:9,1)*0.1747 - 1631.5

RudderAng = sind((EQs(1:9,2)*0.00036320754) - 3.1802);

RigtigVinkel = EQs(1:9,2)*0.00036320754 - 3.1802

tau = (RudderAng.* ThrottleForce) * 1.2 

Drag = 2*tau./(EQs(1:9,3))

figure(1)
plot(Drag, '-o')



